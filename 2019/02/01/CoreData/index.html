<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>CoreData | JKing&#39;s Notes</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="闻过而终礼，知耻而后勇">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="CoreData | JKing&#39;s Notes">
    <meta name="twitter:description" content="闻过而终礼，知耻而后勇">

    <meta property="og:type" content="article">
    <meta property="og:title" content="CoreData | JKing&#39;s Notes">
    <meta property="og:description" content="闻过而终礼，知耻而后勇">

    
    <meta name="author" content="JKing">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="JKing&#39;s Notes" href="/atom.xml">
    

    <link rel="canonical" href="http://yoursite.com/2019/02/01/CoreData/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 JKing&#39;s Notes 的主页"><img src="/images/avatar.jpg" width="80" alt="JKing&#39;s Notes logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for JKing&#39;s Notes">JKing&#39;s Notes</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Yesterday you said tomorrow</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">闻过而终礼，知耻而后勇</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="/favourite">黄金屋</a></li>
            
              <li class="navigation__item"><a href="/favourite/time.html">时光机</a></li>
            
              <li class="navigation__item"><a href="/favourite/image.html">幻想间</a></li>
            
              <li class="navigation__item"><a href="/aboutme">关于我</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/monniya" title="GitHub" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/onlymonniya" title="Twitter" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2019-02-01T02:48:49.000Z" class="post-list__meta--date date">2019-02-01</time> &#8226; <span class="post-meta__tags tags">于  </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">CoreData</h1>
  </header>

  <section class="post">
    <h1 id="1-创建托管对象模型"><a href="#1-创建托管对象模型" class="headerlink" title="1. 创建托管对象模型"></a>1. 创建托管对象模型</h1><p>CoreData的很多功能都依赖于你创建的实体类的描述、属性、关系的模式。CoreData使用一个名为托管对象模型的模式——<code>NSManagedObjectModel</code>的实例。一般来说，模型越丰富，CoreData支持你编写的应用程序的能力就越强。</p>
<p>托管对象模型允许CoreData从持久存储中的记录映射到应用程序中使用的托管对象。模型是实体描述对象(<code>NSEntityDescription</code>的实例)的集合。实体描述根据实体的名称、用于表示应用程序中的实体的类的名称以及它具有哪些属性(属性和关系)来描述实体(可以将其视为数据库中的表)。</p>
<h2 id="创建实体和实体的属性"><a href="#创建实体和实体的属性" class="headerlink" title="创建实体和实体的属性"></a>创建实体和实体的属性</h2><p>在Xcode中启动新项目并打开模板选择对话框时，选择Use Core Data。CoreData模型的源文件会作为模板的一部分创建，该源文件的扩展名为<code>.xcdatamodeld</code>。在导航区域中选择该文件以显示CoreData模型编辑器。</p>
<h2 id="实体名和类名"><a href="#实体名和类名" class="headerlink" title="实体名和类名"></a>实体名和类名</h2><p>注意，实体名和类名(NSManagedObject的子类)是不同的。数据模型中的实体结构不需要匹配类层次结构。官方推荐的类名带个MO后缀。</p>
<h6 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h6><p>在使用SQLite持久存储时，要小心实体继承。从另一个实体继承的所有实体都存在于SQLite中的同一个表中。SQLite持久存储设计中的这个因素可能会造成性能问题。</p>
<p>#2. CoreData栈</p>
<h3 id="1-NSPersistentContainer（持久化容器）"><a href="#1-NSPersistentContainer（持久化容器）" class="headerlink" title="1.NSPersistentContainer（持久化容器）"></a>1.NSPersistentContainer（持久化容器）</h3><p>从iOS 10和macOS 10.12开始，<code>NSPersistentContainer</code>处理核心数据栈的创建，并提供对<code>NSManagedObjectContext</code>的访问，以及许多方便的方法。在iOS 10和macOS 10.12之前，核心数据栈的创建更加复杂。</p>
<h3 id="2-NSManagedObjectModel（受托管的模型对象）"><a href="#2-NSManagedObjectModel（受托管的模型对象）" class="headerlink" title="2.NSManagedObjectModel（受托管的模型对象）"></a>2.NSManagedObjectModel（受托管的模型对象）</h3><p><code>NSManagedObjectModel</code>实例描述核心数据栈将要访问的数据。在创建<code>Core Data 堆栈</code>期间，<code>NSManagedObjectModel</code>作为创建堆栈的第一步加载到内存中。初始化<code>NSManagedObjectModel</code>对象之后，构造<code>NSPersistentStoreCoordinator</code>对象。</p>
<h3 id="3-NSPersistentStoreCoordinator（持久化存储协调器）"><a href="#3-NSPersistentStoreCoordinator（持久化存储协调器）" class="headerlink" title="3.NSPersistentStoreCoordinator（持久化存储协调器）"></a>3.NSPersistentStoreCoordinator（持久化存储协调器）</h3><ul>
<li><code>NSPersistentStoreCoordinator</code>位于<code>Core Data 堆栈</code>的中间，负责实现在模型中定义的实体的实例。它在模型中创建实体的新实例，并从持久存储<code>(NSPersistentStore)</code>检索现有实例。持久性存储可以在磁盘上或内存中。根据应用程序的结构，可以由<code>NSPersistentStoreCoordinator</code>协调多个持久性存储，尽管这种情况并不常见。</li>
<li><code>NSManagedObjectModel</code>定义数据的结构，而<code>NSPersistentStoreCoordinator</code>从持久存储中的数据实现对象，并将这些对象传递给请求者<code>NSManagedObjectContext</code>。<code>NSPersistentStoreCoordinator</code>还验证数据状态是否与<code>NSManagedObjectModel</code>中定义匹配的一致。</li>
<li>将<code>NSPersistentStore</code>添加到<code>NSPersistentStoreCoordinator</code>的调用是异步执行的。有几种情况会导致此调用阻塞调用线程(例如，与iCloud的集成和迁移)。因此，最好异步执行此调用，以避免阻塞用户界面队列。</li>
</ul>
<h3 id="4-NSManagedObjectContext（受托管对象上下文）"><a href="#4-NSManagedObjectContext（受托管对象上下文）" class="headerlink" title="4.NSManagedObjectContext（受托管对象上下文）"></a>4.NSManagedObjectContext（受托管对象上下文）</h3><ul>
<li><p>托管对象上下文<code>(NSManagedObjectContext)</code>是应用程序将与之交互最多的对象，因此它是应用程序其余部分公开的对象。可以将它看作是智能的草稿本。当您从持久存储中获取对象时，您将临时副本带到临时存储区，在那里它们形成一个对象图(或对象图的集合)。然后可以根据自己的喜好修改这些对象。但是，除非您实际保存这些更改，否则持久性存储将保持不变。</p>
</li>
<li><p>所有托管对象都必须在上下文中注册。您可以使用上下文将对象添加到对象图中，并从对象图中删除对象。上下文跟踪您对单个对象的属性和对象之间的关系所做的更改。通过跟踪更改，上下文能够为您提供撤销和重做支持。它还确保如果您更改了对象之间的关系，则可以维护对象图的完整性。</p>
</li>
<li><p>如果选择保存所做的更改，上下文将确保对象处于有效状态。如果是，则将更改写入持久性存储(或多个存储)，为创建的对象添加新记录，并为删除的对象删除记录。</p>
</li>
<li><p>没有<code>CoreData</code>，您必须编写方法来支持数据的归档和非归档，跟踪模型对象，并与undo manager交互以支持undo。在<code>CoreData</code>框架中，大部分功能是自动提供的，主要是通过托管对象上下文提供的。</p>
</li>
</ul>
<h1 id="3-创建并保存受托管的对象"><a href="#3-创建并保存受托管的对象" class="headerlink" title="3. 创建并保存受托管的对象"></a>3. 创建并保存受托管的对象</h1><p><code>NSManagedObject</code>实例实现核心数据模型对象所需的基本行为。<code>NSManagedObject</code>实例需要两个元素:实体描述(NSEntityDescription实例)和托管对象上下文(NSManagedObjectContext实例)。实体描述包括对象所表示的实体的名称及其属性和关系。托管对象上下文表示在其中创建托管对象的草稿。上下文跟踪对象的更改和对象之间的关系。</p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Newer Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2019/02/15/MacOS-配置Apache-php/" title="MacOS 配置Apache+php">MacOS 配置Apache+php</a></h2>
                <p class="excerpt">
                
                常用路径以及命令
Apatche: /etc/apache2配置文件: /etc/apache2/httpd.conf启动apatch: $sudo apachectl -k start关闭apatch: $sudo apachectl -k stop重启apatch: $sudo apachect
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2019-02-15T02:15:49.000Z" class="post-list__meta--date date">2019-02-15</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2019/02/15/MacOS-配置Apache-php/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/07/26/记一次使用ReactiveCocoa的小问题/" title="记一次使用ReactiveCocoa的小问题">记一次使用ReactiveCocoa的小问题</a></h2>
                <p class="excerpt">
                
                
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-07-26T08:04:22.000Z" class="post-list__meta--date date">2018-07-26</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/07/26/记一次使用ReactiveCocoa的小问题/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2019 JKing - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
